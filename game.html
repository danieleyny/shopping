<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
  <title>Safe Consulting | Secure Access</title>
  <link href="https://fonts.googleapis.com/css2?family=Permanent+Marker&display=swap" rel="stylesheet">
  <style>
    :root {
      --spray: #34d197;
      --bg: #0d0d0d;
      --text: #f0f0f0;
    }
    * { box-sizing: border-box; margin: 0; padding: 0; touch-action: none; }

    body {
      background: var(--bg);
      color: var(--text);
      font-family: 'Georgia', serif;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      height: 100vh;
      width: 100vw;
      overflow: hidden;
      position: fixed;
    }

    #game-container {
      position: relative;
      border: 2px solid rgba(52, 209, 151, 0.4);
      box-shadow: 0 0 30px rgba(52, 209, 151, 0.15);
      background: #111;
      cursor: pointer;
    }

    canvas { display: block; }

    .ui {
      text-align: center;
      margin-bottom: 20px;
    }

    h1 {
      font-family: 'Permanent Marker', cursive;
      color: var(--spray);
      font-size: 2.2rem;
      letter-spacing: 2px;
      margin-bottom: 5px;
      text-shadow: 0 0 10px rgba(52, 209, 151, 0.3);
    }

    .status { font-size: 0.9rem; text-transform: uppercase; letter-spacing: 3px; color: #888; }
    #score-display { color: var(--spray); font-weight: bold; margin-top: 5px; }

    .start-prompt {
      position: absolute;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      color: var(--spray);
      font-family: 'Permanent Marker', cursive;
      font-size: 1.4rem;
      pointer-events: none;
      text-align: center;
      width: 100%;
      animation: pulse 1.5s infinite;
    }

    @keyframes pulse {
      0%, 100% { opacity: 1; }
      50% { opacity: 0.5; }
    }
  </style>
</head>
<body>

  <div class="ui">
    <h1>Catalog Access</h1>
    <p class="status">Collect 5 Money Bags to Unlock</p>
    <p id="score-display">Progress: 0/5</p>
  </div>

  <div id="game-container">
    <canvas id="gameCanvas"></canvas>
    <div id="start-overlay" class="start-prompt">SWIPE ANYWHERE TO START</div>
  </div>

  <script>
    const canvas = document.getElementById("gameCanvas");
    const ctx = canvas.getContext("2d");
    const scoreDisplay = document.getElementById("score-display");
    const startOverlay = document.getElementById("start-overlay");

    // --- GAME CONFIG ---
    const isMobile = window.innerWidth <= 768;
    const gridSize = 24; 
    const moveSpeed = isMobile ? 3 : 4; // Pixels per frame (Smooth motion)
    const targetScore = 5;
    
    let score = 0;
    let gameStarted = false;
    let frameId;

    const size = Math.min(window.innerWidth - 40, 400);
    canvas.width = Math.floor(size / gridSize) * gridSize;
    canvas.height = canvas.width;

    let snake = {
      x: canvas.width / 2,
      y: canvas.height / 2,
      dir: 'RIGHT',
      nextDir: 'RIGHT',
      body: [],
      length: 3 // Starting body segments
    };

    let food = getRandomFood();

    function getRandomFood() {
      return {
        x: Math.floor(Math.random() * (canvas.width / gridSize)) * gridSize + gridSize/2,
        y: Math.floor(Math.random() * (canvas.height / gridSize)) * gridSize + gridSize/2
      };
    }

    // --- RENDER LOOP (60 FPS) ---
    function update() {
      if (!gameStarted) return;

      // Update Direction
      snake.dir = snake.nextDir;

      // Move Head
      if (snake.dir === 'LEFT') snake.x -= moveSpeed;
      if (snake.dir === 'RIGHT') snake.x += moveSpeed;
      if (snake.dir === 'UP') snake.y -= moveSpeed;
      if (snake.dir === 'DOWN') snake.y += moveSpeed;

      // Record path for body to follow
      snake.body.unshift({ x: snake.x, y: snake.y });
      if (snake.body.length > (snake.length * (gridSize / moveSpeed))) {
        snake.body.pop();
      }

      // Wall Collision
      if (snake.x < 0 || snake.x > canvas.width || snake.y < 0 || snake.y > canvas.height) {
        gameOver();
        return;
      }

      // Food Collision
      const dist = Math.hypot(snake.x - food.x, snake.y - food.y);
      if (dist < gridSize) {
        score++;
        snake.length += 2;
        scoreDisplay.innerText = `Progress: ${score}/${targetScore}`;
        if (score >= targetScore) {
          victory();
          return;
        }
        food = getRandomFood();
      }

      draw();
      frameId = requestAnimationFrame(update);
    }

    function draw() {
      ctx.fillStyle = "#111";
      ctx.fillRect(0, 0, canvas.width, canvas.height);

      // Draw Grid (Subtle)
      ctx.strokeStyle = "rgba(52, 209, 151, 0.05)";
      for(let i=0; i<=canvas.width; i+=gridSize) {
        ctx.beginPath(); ctx.moveTo(i,0); ctx.lineTo(i,canvas.height); ctx.stroke();
        ctx.beginPath(); ctx.moveTo(0,i); ctx.lineTo(canvas.width,i); ctx.stroke();
      }

      // Draw Food
      ctx.font = "20px Arial";
      ctx.textAlign = "center";
      ctx.textBaseline = "middle";
      ctx.fillText("ðŸ’°", food.x, food.y);

      // Draw Body (Smooth Trail)
      ctx.beginPath();
      ctx.setLineDash([]);
      ctx.strokeStyle = "rgba(52, 209, 151, 0.4)";
      ctx.lineWidth = gridSize - 6;
      ctx.lineCap = "round";
      ctx.lineJoin = "round";
      ctx.moveTo(snake.x, snake.y);
      
      // Draw snake segments based on path history
      for (let i = 0; i < snake.body.length; i += Math.floor(gridSize / moveSpeed)) {
        const part = snake.body[i];
        ctx.lineTo(part.x, part.y);
      }
      ctx.stroke();

      // Draw Head
      ctx.save();
      ctx.translate(snake.x, snake.y);
      let angle = 0;
      if (snake.dir === 'RIGHT') angle = 0;
      if (snake.dir === 'LEFT') angle = Math.PI;
      if (snake.dir === 'UP') angle = -Math.PI / 2;
      if (snake.dir === 'DOWN') angle = Math.PI / 2;
      ctx.rotate(angle);

      ctx.fillStyle = "#34d197";
      ctx.beginPath();
      ctx.moveTo(12, 0); ctx.lineTo(-8, -10); ctx.lineTo(-4, 0); ctx.lineTo(-8, 10);
      ctx.closePath(); ctx.fill();

      // Eyes
      ctx.fillStyle = "white";
      ctx.beginPath(); ctx.arc(2, -4, 2, 0, Math.PI*2); ctx.arc(2, 4, 2, 0, Math.PI*2); ctx.fill();
      ctx.restore();
    }

    function startGame() {
      if (!gameStarted) {
        gameStarted = true;
        startOverlay.style.display = "none";
        update();
      }
    }

    function gameOver() {
      cancelAnimationFrame(frameId);
      alert("Not good enough. Try again");
      location.reload();
    }

    function victory() {
      cancelAnimationFrame(frameId);
      ctx.fillStyle = "rgba(52, 209, 151, 0.9)";
      ctx.fillRect(0, 0, canvas.width, canvas.height);
      ctx.fillStyle = "black";
      ctx.font = "bold 24px Georgia";
      ctx.textAlign = "center";
      ctx.fillText("ACCESS GRANTED", canvas.width/2, canvas.height/2);
      setTimeout(() => { window.location.href = "catalog.html"; }, 1000);
    }

    // --- RESPONSIVE CONTROLS ---
    function handleInput(newDir) {
      if (!gameStarted) { startGame(); return; }
      const opposites = { 'UP': 'DOWN', 'DOWN': 'UP', 'LEFT': 'RIGHT', 'RIGHT': 'LEFT' };
      if (newDir !== opposites[snake.dir]) {
        snake.nextDir = newDir;
      }
    }

    window.addEventListener("keydown", e => {
      if (e.key === "ArrowUp") handleInput("UP");
      if (e.key === "ArrowDown") handleInput("DOWN");
      if (e.key === "ArrowLeft") handleInput("LEFT");
      if (e.key === "ArrowRight") handleInput("RIGHT");
    });

    let tsX, tsY;
    window.addEventListener('touchstart', e => { tsX = e.touches[0].clientX; tsY = e.touches[0].clientY; }, {passive: false});
    window.addEventListener('touchmove', e => { if(gameStarted) e.preventDefault(); }, {passive: false});
    window.addEventListener('touchend', e => {
      let teX = e.changedTouches[0].clientX;
      let teY = e.changedTouches[0].clientY;
      let dx = teX - tsX; let dy = teY - tsY;
      if (Math.abs(dx) > Math.abs(dy)) {
        if (Math.abs(dx) > 20) handleInput(dx > 0 ? "RIGHT" : "LEFT");
      } else {
        if (Math.abs(dy) > 20) handleInput(dy > 0 ? "DOWN" : "UP");
      }
    });

    // Initial draw
    draw();
  </script>
</body>
</html>